<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OpenGradient Model Assistant</title>
<link rel="icon" type="image/jpeg" href="/static/logo.jpg">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Syne:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #050508;
    --surface: #0d0d14;
    --border: #1a1a2e;
    --accent: #00ff88;
    --accent2: #7c3aed;
    --text: #e8e8f0;
    --muted: #6b6b80;
    --user-bg: #0f0f1a;
    --bot-bg: #0a0a12;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Animated background grid */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      linear-gradient(rgba(0,255,136,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,255,136,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* Header */
  header {
    position: relative;
    z-index: 10;
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(5,5,8,0.9);
    backdrop-filter: blur(20px);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo-icon {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .logo-text {
    font-size: 18px;
    font-weight: 800;
    letter-spacing: -0.5px;
  }

  .logo-text span {
    color: var(--accent);
  }

  .stats-bar {
    display: flex;
    gap: 24px;
    align-items: center;
  }

  .stat {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }

  .stat-value {
    font-family: 'Space Mono', monospace;
    font-size: 16px;
    font-weight: 700;
    color: var(--accent);
    line-height: 1;
  }

  .stat-label {
    font-size: 10px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 8px var(--accent);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  /* Main layout */
  .main {
    flex: 1;
    display: flex;
    overflow: hidden;
    position: relative;
    z-index: 1;
  }

  /* Sidebar */
  .sidebar {
    width: 260px;
    border-right: 1px solid var(--border);
    padding: 20px 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow-y: auto;
    background: rgba(13,13,20,0.5);
  }

  .sidebar-title {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    padding: 0 8px 8px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 4px;
  }

  .category-chip {
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    color: var(--muted);
  }

  .category-chip:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(0,255,136,0.05);
  }

  .category-chip .count {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    background: rgba(0,255,136,0.1);
    padding: 2px 6px;
    border-radius: 4px;
  }

  .quick-prompts-title {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    padding: 12px 8px 8px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 4px;
  }

  .quick-prompt {
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid var(--border);
    cursor: pointer;
    font-size: 12px;
    color: var(--muted);
    transition: all 0.2s;
    line-height: 1.4;
  }

  .quick-prompt:hover {
    border-color: var(--accent2);
    color: var(--text);
    background: rgba(124,58,237,0.08);
  }

  /* Chat area */
  .chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .messages {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    scroll-behavior: smooth;
  }

  .messages::-webkit-scrollbar { width: 4px; }
  .messages::-webkit-scrollbar-track { background: transparent; }
  .messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  /* Welcome */
  .welcome {
    text-align: center;
    padding: 60px 20px;
    animation: fadeIn 0.6s ease;
  }

  .welcome-icon {
    font-size: 48px;
    margin-bottom: 16px;
    display: block;
  }

  .welcome h2 {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 8px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .welcome p {
    color: var(--muted);
    font-size: 14px;
    max-width: 400px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Messages */
  .message {
    display: flex;
    gap: 12px;
    animation: slideUp 0.3s ease;
    max-width: 800px;
  }

  .message.user { flex-direction: row-reverse; align-self: flex-end; }
  .message.bot { align-self: flex-start; }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .avatar {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .message.user .avatar {
    background: linear-gradient(135deg, var(--accent2), #4f46e5);
  }

  .message.bot .avatar {
    background: linear-gradient(135deg, var(--accent), #00cc6a);
  }

  .bubble {
    padding: 12px 16px;
    border-radius: 12px;
    font-size: 14px;
    line-height: 1.6;
    max-width: 600px;
  }

  .message.user .bubble {
    background: var(--user-bg);
    border: 1px solid var(--border);
    border-top-right-radius: 4px;
  }

  .message.bot .bubble {
    background: var(--bot-bg);
    border: 1px solid var(--border);
    border-top-left-radius: 4px;
  }

  .bubble strong {
    color: var(--accent);
    font-weight: 600;
  }

  .bubble code {
    font-family: 'Space Mono', monospace;
    background: rgba(0,255,136,0.08);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 12px;
    color: var(--accent);
  }

  /* Typing indicator */
  .typing {
    display: flex;
    gap: 4px;
    padding: 12px 16px;
    background: var(--bot-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    border-top-left-radius: 4px;
    width: fit-content;
  }

  .typing span {
    width: 6px;
    height: 6px;
    background: var(--accent);
    border-radius: 50%;
    animation: bounce 1.2s infinite;
  }

  .typing span:nth-child(2) { animation-delay: 0.2s; }
  .typing span:nth-child(3) { animation-delay: 0.4s; }

  @keyframes bounce {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-6px); opacity: 1; }
  }

  /* Input area */
  .input-area {
    padding: 16px 24px 20px;
    border-top: 1px solid var(--border);
    background: rgba(5,5,8,0.9);
    backdrop-filter: blur(20px);
  }

  .input-wrapper {
    display: flex;
    gap: 12px;
    align-items: flex-end;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px 16px;
    transition: border-color 0.2s;
  }

  .input-wrapper:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px rgba(0,255,136,0.2);
  }

  textarea {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 14px;
    resize: none;
    max-height: 120px;
    min-height: 20px;
    line-height: 1.5;
  }

  textarea::placeholder { color: var(--muted); }

  .send-btn {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: none;
    background: linear-gradient(135deg, var(--accent), #00cc6a);
    color: #000;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .send-btn:hover { transform: scale(1.05); box-shadow: 0 0 16px rgba(0,255,136,0.4); }
  .send-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .input-hint {
    font-size: 11px;
    color: var(--muted);
    margin-top: 8px;
    padding: 0 4px;
  }

  /* Mobile */
  @media (max-width: 768px) {
    header {
      padding: 10px 14px;
    }
    .logo-text {
      font-size: 14px;
    }
    .stats-bar {
      gap: 12px;
    }
    .stat-value {
      font-size: 13px;
    }
    .sidebar {
      display: none;
    }
    .messages {
      padding: 14px;
      gap: 14px;
    }
    .bubble {
      font-size: 13px;
      max-width: 85vw;
    }
    .input-area {
      padding: 10px 14px 14px;
    }
    .welcome h2 {
      font-size: 20px;
    }
    .welcome {
      padding: 30px 16px;
    }
    .welcome-icon {
      width: 56px !important;
      height: 56px !important;
    }
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">
      <img src="/static/logo.jpg" alt="OpenGradient" style="width:36px;height:36px;border-radius:8px;object-fit:cover;">
    </div>
    <div class="logo-text">Open<span>Gradient</span> Assistant</div>
  </div>
  <div class="stats-bar">
    <div class="stat">
      <div class="stat-value" id="total-models">‚Äî</div>
      <div class="stat-label">Models</div>
    </div>
    <div class="stat">
      <div class="stat-value" style="color:#7c3aed">TEE</div>
      <div class="stat-label">Verified</div>
    </div>
    <div class="status-dot"></div>
  </div>
</header>

<div class="main">
  <div class="sidebar">
    <div class="sidebar-title">Quick Search</div>
    <div class="quick-prompt" onclick="sendQuick('Find models for ETH price prediction')">üìà ETH price prediction</div>
    <div class="quick-prompt" onclick="sendQuick('Show me DeFi risk analysis models')">‚ö†Ô∏è DeFi risk analysis</div>
    <div class="quick-prompt" onclick="sendQuick('I need a text classification model')">üìù Text classification</div>
    <div class="quick-prompt" onclick="sendQuick('Models for Sybil attack detection')">üõ°Ô∏è Sybil detection</div>
    <div class="quick-prompt" onclick="sendQuick('Show me protocol optimization models')">‚öôÔ∏è Protocol optimization</div>

    <div class="sidebar-title" style="margin-top:16px;">More OpenGradient Products</div>
    <a href="https://www.twin.fun/" target="_blank" class="quick-prompt" style="text-decoration:none;display:block;">ü§ñ twin.fun</a>
    <a href="https://www.bitquant.io/" target="_blank" class="quick-prompt" style="text-decoration:none;display:block;">üìä Bitquant</a>

    <div class="sidebar-title" style="margin-top:16px;">Useful to Study</div>
    <a href="https://github.com/OpenGradient" target="_blank" class="quick-prompt" style="text-decoration:none;display:block;">üêô GitHub</a>
    <a href="https://www.opengradient.ai/" target="_blank" class="quick-prompt" style="text-decoration:none;display:block;">üåê Official Website</a>
    <a href="https://docs.opengradient.ai/" target="_blank" class="quick-prompt" style="text-decoration:none;display:block;">üìö Technical Docs</a>
  </div>

  <div class="chat-area">
    <div class="messages" id="messages">
      <div class="welcome">
        <img src="/static/logo.jpg" alt="OpenGradient" class="welcome-icon" style="width:72px;height:72px;border-radius:16px;object-fit:cover;margin-bottom:16px;display:block;margin-left:auto;margin-right:auto;">
        <h2>Model Hub Assistant</h2>
        <p>Ask me to find AI models for your task.</p>
      </div>
    </div>

    <div class="input-area">
      <div class="input-wrapper">
        <textarea 
          id="input" 
          placeholder="Describe what you need a model for..." 
          rows="1"
          onkeydown="handleKey(event)"
          oninput="autoResize(this)"
        ></textarea>
        <button class="send-btn" id="send-btn" onclick="sendMessage()">‚Üë</button>
      </div>
      <div class="input-hint">Press Enter to send ¬∑ Shift+Enter for new line</div>
    </div>
    <div style="font-size:11px;color:#4a4a60;text-align:center;padding:8px 24px 12px;">Some models are empty and do not contain any information for use. The database is updated every 24 hours.</div>
    <div style="position:fixed;bottom:10px;right:16px;font-size:10px;color:#2a2a40;font-family:'Space Mono',monospace;">Powered by Egoruy</div>
    </div>
  </div>
</div>

<script>
  const sessionId = Math.random().toString(36).slice(2);
  let isLoading = false;

  // Load stats
  fetch('/api/stats')
    .then(r => r.json())
    .then(data => {
      document.getElementById('total-models').textContent = data.total.toLocaleString();
    });

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 120) + 'px';
  }

  function handleKey(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  }

  function sendQuick(text) {
    document.getElementById('input').value = text;
    sendMessage();
  }

  function addMessage(role, text) {
    const welcome = document.querySelector('.welcome');
    if (welcome) welcome.remove();

    const messages = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = `message ${role}`;

    const avatar = role === 'user' ? 'üë§' : `<img src="/static/logo.jpg" style="width:20px;height:20px;border-radius:4px;object-fit:cover;">`;
    
    // Clean up pipe-separated model format from bot responses
    let formatted = text;
    if (role === 'bot') {
      // Remove markdown headers like ####
      formatted = formatted.replace(/#{1,6}\s/g, '');
      // Format pipe-separated model lines: name|category|author|desc
      formatted = formatted.replace(/^(\S+)\|([^|]*)\|([^|]*)\|(.*)$/gm, (_, name, cat, author, desc) => {
        return `<div style="background:rgba(0,212,170,0.06);border:1px solid rgba(0,212,170,0.2);border-radius:8px;padding:10px 12px;margin:6px 0">
          <strong style="color:#00d4aa">${name}</strong>
          ${cat ? `<span style="color:#7c3aed;font-size:12px;margin-left:8px">${cat}</span>` : ''}
          ${author ? `<span style="color:#6b6b80;font-size:11px;margin-left:8px">by ${author}</span>` : ''}
          ${desc ? `<div style="color:#a0a0b0;font-size:12px;margin-top:4px">${desc}</div>` : ''}
        </div>`;
      });
      formatted = formatted
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/`(.*?)`/g, '<code>$1</code>')
        .replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" style="color:#00d4aa;text-decoration:underline;">$1</a>')
        .replace(/\n/g, '<br>');
    } else {
      formatted = formatted.replace(/\n/g, '<br>');
    }

    div.innerHTML = `
      <div class="avatar">${avatar}</div>
      <div class="bubble">${formatted}</div>
    `;

    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function addTyping() {
    const messages = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = 'message bot';
    div.id = 'typing-indicator';
    div.innerHTML = `
      <div class="avatar">‚àá</div>
      <div class="typing"><span></span><span></span><span></span></div>
    `;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function removeTyping() {
    const t = document.getElementById('typing-indicator');
    if (t) t.remove();
  }

  async function sendMessage() {
    const input = document.getElementById('input');
    const text = input.value.trim();
    if (!text || isLoading) return;

    isLoading = true;
    input.value = '';
    input.style.height = 'auto';
    document.getElementById('send-btn').disabled = true;

    addMessage('user', text);
    addTyping();

    try {
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text, session_id: sessionId })
      });
      const data = await res.json();
      removeTyping();

      if (data.error) {
        addMessage('bot', `‚ùå Error: ${data.error}`);
      } else {
        addMessage('bot', data.reply);
      }
    } catch (e) {
      removeTyping();
      addMessage('bot', '‚ùå Connection error. Make sure the server is running.');
    }

    isLoading = false;
    document.getElementById('send-btn').disabled = false;
    input.focus();
  }
</script>
</body>
</html>
